{% extends 'base_diary.html' %}

{% block content %}
  <h2>Create a New Diary</h2>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <label for="{{ form.title.id_for_label }}">Title:</label>
    {{ form.title }}
    <br>
    <label for="{{ form.content.id_for_label }}">Content:</label>
    {{ form.content }}
    <br>    
    <label for="{{ form.img_url.id_for_label }}">Image:</label>
    {{ form.img_url }}
    <br>
    <img src="{{ form.img_url.value.url }}" alt="Diary Image" id="preview-image" style="display: none;">
    <br>
    <button type="button" onclick="submitForm()">Save</button>
  </form>
  <script>
    function submitForm() {
      // 프롬프트 가져오기
      var contentElement = document.querySelector('textarea[name="content"]');
      var content = contentElement.value;

      // Django 뷰로 전송
      $.ajax({
        url: '{% url "django_view" %}',
        type: 'POST',
        data: { content: content },
        dataType: 'json',
        success: function(data) {
          // 성공 시 결과 표시
          var imgUrl = data.img_url;  // 이 부분은 실제 서버 응답에 따라 수정해야 함

          if (imgUrl) {
            // 이미지 URL이 있는 경우 이미지를 표시
            document.getElementById('image-preview').style.display = 'block';
            document.getElementById('preview-image').src = imgUrl;
          }

          // 폼 제출
          document.getElementById('diary-form').submit();
        },
        error: function() {
          // 실패 시 처리
          alert('An error occurred');
        }
      });
    }
  </script>


  <a href="{% url 'diary_list' %}">Cancel</a>
{% endblock %}
